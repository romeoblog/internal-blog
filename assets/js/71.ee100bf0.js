(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{772:function(_,e,t){"use strict";t.r(e);var v=t(97),a=Object(v.a)({},(function(){var _=this,e=_.$createElement,t=_._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"mysql数据库设计规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库设计规范"}},[_._v("#")]),_._v(" MySQL数据库设计规范")]),_._v(" "),t("h2",{attrs:{id:"_1-规范背景与目的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-规范背景与目的"}},[_._v("#")]),_._v(" 1. 规范背景与目的")]),_._v(" "),t("p",[t("code",[_._v("MySQL")]),_._v(" 数据库与 "),t("code",[_._v("Oracle")]),_._v("、 "),t("code",[_._v("SQL Server")]),_._v(" 等数据库相比，有其内核上的优势与劣势。我们在使用 MySQL 数据库的时候需要遵循一定规范，扬长避短。本规范旨在帮助或指导RD、QA、OP 等技术人员做出适合线上业务的数据库设计。在数据库变更和处理流程、数据库表设计、SQL 编写等方面予以规范，从而为公司业务系统稳定、健康地运行提供保障。")]),_._v(" "),t("h2",{attrs:{id:"_2-设计规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-设计规范"}},[_._v("#")]),_._v(" 2. 设计规范")]),_._v(" "),t("h3",{attrs:{id:"_2-1-数据库设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-数据库设计"}},[_._v("#")]),_._v(" 2.1 数据库设计")]),_._v(" "),t("p",[_._v("以下所有规范会按照【高危】、【强制】、【建议】三个级别进行标注，遵守优先级从高到低。对于不满足【高危】和【强制】两个级别的设计，DBA会强制打回要求修改。")]),_._v(" "),t("h4",{attrs:{id:"_2-1-1-库名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-库名"}},[_._v("#")]),_._v(" 2.1.1 库名")]),_._v(" "),t("ol",[t("li",[_._v("【强制】库的名称必须控制在 32 个字符以内，相关模块的表名与表名之间尽量提现 join 的关系，如 user 表和 user_login 表。")]),_._v(" "),t("li",[_._v("【强制】库的名称格式：业务系统名称_子系统名，同一模块使用的表名尽量使用统一前缀。")]),_._v(" "),t("li",[_._v("【强制】一般分库名称命名格式是库通配名_编号，编号从 0 开始递增，比如 wenda_001 以时间进行分库的名称格式是“库通配名_时间”")]),_._v(" "),t("li",[_._v("【强制】创建数据库时必须显式指定字符集，并且字符集只能是utf8或者utf8mb4。创建数据库SQL举例："),t("code",[_._v("create database db1 default character set utf8;")])])]),_._v(" "),t("h4",{attrs:{id:"_2-1-2-表结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-表结构"}},[_._v("#")]),_._v(" 2.1.2 表结构")]),_._v(" "),t("ol",[t("li",[_._v("【强制】表和列的名称必须控制在"),t("code",[_._v("32 个字符")]),_._v("以内，表名只能使用字母、数字和下划线，一律小写。")]),_._v(" "),t("li",[_._v("【强制】表名要求模块名强相关，如师资系统采用"),t("code",[_._v("”sz”")]),_._v("作为前缀，渠道系统采用 "),t("code",[_._v("”qd”")]),_._v(" 作为前缀等。")]),_._v(" "),t("li",[_._v("【强制】创建表时必须显式指定字符集为 "),t("code",[_._v("utf8")]),_._v(" 或 "),t("code",[_._v("utf8mb4")]),_._v("。")]),_._v(" "),t("li",[_._v("【强制】创建表时必须显式指定表存储引擎类型，如无特殊需求，一律为 "),t("code",[_._v("InnoDB")]),_._v(" 。当需要使用除 "),t("code",[_._v("InnoDB/MyISAM/Memory")]),_._v(" 以外的存储引擎时，必须通过 "),t("code",[_._v("DBA")]),_._v(" 审核才能在生产环境中使用。因为 "),t("code",[_._v("Innodb")]),_._v(" 表支持事务、行锁、宕机恢复、MVCC 等关系型数据库重要特性，为业界使用最多的 "),t("code",[_._v("MySQL")]),_._v(" 存储引擎。而这是其他大多数存储引擎不具备的，因此首推InnoDB。")]),_._v(" "),t("li",[_._v("【强制】建表必须有comment")]),_._v(" "),t("li",[_._v("【建议】建表时关于主键：(1)强制要求主键为id，类型为int或bigint，且为auto_increment(2)标识表里每一行主体的字段不要设为主键，建议设为其他字段如user_id，order_id等，并建立unique key索引（可参考cdb.teacher表设计）。因为如果设为主键且主键值为随机插入，则会导致innodb内部page分裂和大量随机I/O，性能下降。")]),_._v(" "),t("li",[_._v("【建议】核心表（如用户表，金钱相关的表）必须有行数据的创建时间字段create_time和最后更新时间字段update_time，便于查问题。")]),_._v(" "),t("li",[_._v("【建议】表中所有字段必须都是NOT NULL属性，业务可以根据需要定义DEFAULT值。因为使用NULL值会存在每一行都会占用额外存储空间、数据迁移容易出错、聚合函数计算结果偏差等问题。")]),_._v(" "),t("li",[_._v("【建议】建议对表里的blob、text等大字段，垂直拆分到其他表里，仅在需要读这些对象的时候才去select。")]),_._v(" "),t("li",[_._v("【建议】反范式设计：把经常需要join查询的字段，在其他表里冗余一份。如user_name属性在user_account，user_login_log等表里冗余一份，减少join查询。")]),_._v(" "),t("li",[_._v("【强制】中间表用于保留中间结果集，名称必须以tmp_开头。备份表用于备份或抓取源表快照，名称必须以bak_开头。中间表和备份表定期清理。")]),_._v(" "),t("li",[_._v("【强制】对于超过100W行的大表进行alter table，必须经过DBA审核，并在业务低峰期执行。因为alter table会产生表锁，期间阻塞对于该表的所有写入，对于业务可能会产生极大影响")])]),_._v(" "),t("p",[_._v("待续...")])])}),[],!1,null,null,null);e.default=a.exports}}]);